<?xml version="1.0" encoding="utf-8"?>
<odoo>
    
    <!-- Custom Invoice Report for Delivery - Modern Professional Design -->
    <template id="report_delivery_invoice_document">
        <t t-call="web.html_container">
            <t t-foreach="docs" t-as="o">
                <t t-set="lang" t-value="o.partner_id.lang"/>
                <t t-call="smart_delivery.report_delivery_invoice_content" t-lang="lang"/>
            </t>
        </t>
    </template>
    
    <template id="report_delivery_invoice_content">
        <t t-set="enterprise" t-value="o.delivery_enterprise_id"/>
        <t t-set="billing" t-value="o.delivery_billing_ids[:1]"/>
        <t t-set="order" t-value="billing.order_id if billing else False"/>
        
        <div class="article" 
             t-att-data-oe-model="o and o._name" 
             t-att-data-oe-id="o and o.id"
             style="font-family: 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif; color: #2c3e50; padding: 0; margin: 0;">
            
            <!-- ============ COLORED HEADER BAR ============ -->
            <div style="background: linear-gradient(135deg, #1a5276 0%, #2980b9 100%); color: white; padding: 25px 30px; margin: -20px -20px 0 -20px;">
                <div style="display: flex; justify-content: space-between; align-items: center;">
                    <div>
                        <!-- Logo -->
                        <t t-if="enterprise and enterprise.logo">
                            <img t-att-src="image_data_uri(enterprise.logo)" 
                                 style="max-height: 70px; max-width: 180px; border-radius: 8px; background: white; padding: 5px;" 
                                 alt="Logo"/>
                        </t>
                        <t t-elif="o.company_id.logo">
                            <img t-att-src="image_data_uri(o.company_id.logo)" 
                                 style="max-height: 70px; max-width: 180px; border-radius: 8px; background: white; padding: 5px;" 
                                 alt="Logo"/>
                        </t>
                    </div>
                    <div style="text-align: right;">
                        <t t-if="enterprise">
                            <div style="font-size: 24px; font-weight: 700; letter-spacing: 1px;">
                                <t t-esc="enterprise.name"/>
                            </div>
                            <div style="font-size: 13px; opacity: 0.9; margin-top: 5px;">
                                <t t-if="enterprise.address"><t t-esc="enterprise.address"/></t>
                                <t t-if="enterprise.city"> - <t t-esc="enterprise.city"/></t>
                            </div>
                            <div style="font-size: 12px; opacity: 0.85; margin-top: 3px;">
                                <t t-if="enterprise.phone"><t t-esc="enterprise.phone"/></t>
                                <t t-if="enterprise.email"> ‚Ä¢ <t t-esc="enterprise.email"/></t>
                            </div>
                        </t>
                        <t t-else="">
                            <div style="font-size: 24px; font-weight: 700;">
                                <span t-field="o.company_id.name"/>
                            </div>
                        </t>
                    </div>
                </div>
            </div>
            
            <!-- ============ INVOICE TITLE SECTION ============ -->
            <div style="padding: 30px; background: #f8f9fa;">
                <div style="display: flex; justify-content: space-between; align-items: flex-start;">
                    <div>
                        <div style="font-size: 32px; font-weight: 700; color: #1a5276; margin-bottom: 5px;">
                            <t t-if="o.move_type == 'out_invoice' and o.state == 'posted'">FACTURE</t>
                            <t t-elif="o.move_type == 'out_invoice' and o.state == 'draft'">PROFORMA</t>
                            <t t-elif="o.move_type == 'out_invoice' and o.state == 'cancel'">ANNUL√âE</t>
                            <t t-elif="o.move_type == 'out_refund'">AVOIR</t>
                            <t t-else="">DOCUMENT</t>
                        </div>
                        <div style="font-size: 18px; color: #7f8c8d;">
                            N¬∞ <span t-field="o.name" style="font-weight: 600; color: #2c3e50;"/>
                        </div>
                    </div>
                    <div style="text-align: right;">
                        <t t-if="o.payment_state == 'paid'">
                            <div style="display: inline-block; background: linear-gradient(135deg, #27ae60 0%, #2ecc71 100%); color: white; padding: 12px 25px; border-radius: 25px; font-weight: 700; font-size: 14px; box-shadow: 0 3px 10px rgba(39,174,96,0.3);">
                                ‚úì PAY√â
                            </div>
                        </t>
                        <t t-elif="o.payment_state == 'partial'">
                            <div style="display: inline-block; background: linear-gradient(135deg, #f39c12 0%, #f1c40f 100%); color: white; padding: 12px 25px; border-radius: 25px; font-weight: 700; font-size: 14px;">
                                PARTIEL
                            </div>
                        </t>
                        <t t-else="">
                            <div style="display: inline-block; background: linear-gradient(135deg, #e74c3c 0%, #c0392b 100%); color: white; padding: 12px 25px; border-radius: 25px; font-weight: 700; font-size: 14px;">
                                EN ATTENTE
                            </div>
                        </t>
                    </div>
                </div>
            </div>
            
            <!-- ============ CLIENT &amp; INVOICE INFO ============ -->
            <div style="padding: 0 30px; margin-top: 25px;">
                <div style="display: flex; gap: 20px;">
                    <!-- Client Info -->
                    <div style="flex: 1; background: white; border: 1px solid #e0e0e0; border-radius: 10px; padding: 20px; box-shadow: 0 2px 8px rgba(0,0,0,0.05);">
                        <div style="font-size: 11px; text-transform: uppercase; letter-spacing: 2px; color: #7f8c8d; margin-bottom: 12px; font-weight: 600;">
                            Factur√© √†
                        </div>
                        <div style="font-size: 18px; font-weight: 700; color: #2c3e50; margin-bottom: 8px;">
                            <span t-field="o.partner_id.name"/>
                        </div>
                        <div style="color: #7f8c8d; font-size: 13px; line-height: 1.6;">
                            <t t-if="o.partner_id.phone">
                                <div>üìû <span t-field="o.partner_id.phone"/></div>
                            </t>
                            <t t-if="o.partner_id.email">
                                <div>‚úâÔ∏è <span t-field="o.partner_id.email"/></div>
                            </t>
                            <t t-if="o.partner_id.street">
                                <div>üìç <span t-field="o.partner_id.street"/></div>
                            </t>
                        </div>
                    </div>
                    
                    <!-- Invoice Details -->
                    <div style="flex: 1; background: white; border: 1px solid #e0e0e0; border-radius: 10px; padding: 20px; box-shadow: 0 2px 8px rgba(0,0,0,0.05);">
                        <div style="font-size: 11px; text-transform: uppercase; letter-spacing: 2px; color: #7f8c8d; margin-bottom: 12px; font-weight: 600;">
                            D√©tails
                        </div>
                        <table style="width: 100%; font-size: 13px;">
                            <tr>
                                <td style="padding: 6px 0; color: #7f8c8d;">Date d'√©mission</td>
                                <td style="padding: 6px 0; text-align: right; font-weight: 600; color: #2c3e50;">
                                    <span t-field="o.invoice_date"/>
                                </td>
                            </tr>
                            <t t-if="o.invoice_date_due">
                                <tr>
                                    <td style="padding: 6px 0; color: #7f8c8d;">Date d'√©ch√©ance</td>
                                    <td style="padding: 6px 0; text-align: right; font-weight: 600; color: #2c3e50;">
                                        <span t-field="o.invoice_date_due"/>
                                    </td>
                                </tr>
                            </t>
                            <t t-if="o.invoice_origin">
                                <tr>
                                    <td style="padding: 6px 0; color: #7f8c8d;">R√©f√©rence commande</td>
                                    <td style="padding: 6px 0; text-align: right; font-weight: 600; color: #1a5276;">
                                        <span t-field="o.invoice_origin"/>
                                    </td>
                                </tr>
                            </t>
                        </table>
                    </div>
                </div>
            </div>
            
            <!-- ============ DELIVERY INFO (if available) ============ -->
            <t t-if="order">
                <div style="padding: 0 30px; margin-top: 20px;">
                    <div style="background: linear-gradient(135deg, #e8f4f8 0%, #d4edda 100%); border-radius: 10px; padding: 15px 20px; border-left: 4px solid #1a5276;">
                        <div style="font-size: 11px; text-transform: uppercase; letter-spacing: 2px; color: #1a5276; margin-bottom: 8px; font-weight: 600;">
                            üöö Informations de Livraison
                        </div>
                        <div style="display: flex; gap: 30px; font-size: 13px; color: #2c3e50;">
                            <div>
                                <strong>Destinataire:</strong> <t t-esc="order.receiver_name or '-'"/>
                            </div>
                            <div>
                                <strong>T√©l√©phone:</strong> <t t-esc="order.receiver_phone or '-'"/>
                            </div>
                            <div>
                                <strong>Commande:</strong> <t t-esc="order.name or '-'"/>
                            </div>
                        </div>
                    </div>
                </div>
            </t>
            
            <!-- ============ INVOICE LINES ============ -->
            <div style="padding: 0 30px; margin-top: 25px;">
                <table style="width: 100%; border-collapse: collapse;">
                    <thead>
                        <tr style="background: #1a5276;">
                            <th style="padding: 14px 15px; text-align: left; color: white; font-weight: 600; font-size: 12px; text-transform: uppercase; letter-spacing: 1px; border-radius: 8px 0 0 0;">Description</th>
                            <th style="padding: 14px 15px; text-align: center; color: white; font-weight: 600; font-size: 12px; text-transform: uppercase; letter-spacing: 1px; width: 80px;">Qt√©</th>
                            <th style="padding: 14px 15px; text-align: right; color: white; font-weight: 600; font-size: 12px; text-transform: uppercase; letter-spacing: 1px; width: 110px;">Prix Unit.</th>
                            <th style="padding: 14px 15px; text-align: right; color: white; font-weight: 600; font-size: 12px; text-transform: uppercase; letter-spacing: 1px; width: 110px; border-radius: 0 8px 0 0;">Total</th>
                        </tr>
                    </thead>
                    <tbody>
                        <t t-foreach="o.invoice_line_ids.filtered(lambda l: not l.display_type)" t-as="line">
                            <tr style="border-bottom: 1px solid #ecf0f1;" t-att-style="'background: %s;' % ('#f8f9fa' if line_index % 2 else 'white')">
                                <td style="padding: 14px 15px; color: #2c3e50;">
                                    <span t-field="line.name"/>
                                </td>
                                <td style="padding: 14px 15px; text-align: center; color: #7f8c8d;">
                                    <span t-field="line.quantity"/>
                                </td>
                                <td style="padding: 14px 15px; text-align: right; color: #7f8c8d;">
                                    <span t-field="line.price_unit"/>
                                </td>
                                <td style="padding: 14px 15px; text-align: right; font-weight: 700; color: #2c3e50;">
                                    <span t-field="line.price_subtotal"/>
                                </td>
                            </tr>
                        </t>
                    </tbody>
                </table>
            </div>
            
            <!-- ============ TOTALS ============ -->
            <div style="padding: 0 30px; margin-top: 20px;">
                <div style="display: flex; justify-content: flex-end;">
                    <div style="width: 300px;">
                        <div style="display: flex; justify-content: space-between; padding: 10px 0; border-bottom: 1px solid #ecf0f1;">
                            <span style="color: #7f8c8d;">Sous-total HT</span>
                            <span style="font-weight: 600; color: #2c3e50;"><span t-field="o.amount_untaxed"/></span>
                        </div>
                        <t t-if="o.amount_tax">
                            <div style="display: flex; justify-content: space-between; padding: 10px 0; border-bottom: 1px solid #ecf0f1;">
                                <span style="color: #7f8c8d;">Taxes</span>
                                <span style="font-weight: 600; color: #2c3e50;"><span t-field="o.amount_tax"/></span>
                            </div>
                        </t>
                        <div style="display: flex; justify-content: space-between; padding: 15px; margin-top: 10px; background: linear-gradient(135deg, #1a5276 0%, #2980b9 100%); border-radius: 8px; color: white;">
                            <span style="font-size: 16px; font-weight: 600;">TOTAL</span>
                            <span style="font-size: 20px; font-weight: 700;"><span t-field="o.amount_total"/></span>
                        </div>
                        
                        <t t-if="o.payment_state == 'paid'">
                            <div style="margin-top: 10px; padding: 12px; background: linear-gradient(135deg, #27ae60 0%, #2ecc71 100%); border-radius: 8px; text-align: center; color: white; font-weight: 700;">
                                ‚úì PAY√â INT√âGRALEMENT
                            </div>
                        </t>
                        <t t-elif="o.amount_residual and o.amount_residual != o.amount_total">
                            <div style="margin-top: 10px; padding: 12px; background: #fff3cd; border-radius: 8px; border: 1px solid #ffc107;">
                                <div style="display: flex; justify-content: space-between; color: #856404;">
                                    <span>Reste √† payer</span>
                                    <span style="font-weight: 700;"><span t-field="o.amount_residual"/></span>
                                </div>
                            </div>
                        </t>
                    </div>
                </div>
            </div>
            
            <!-- ============ PAYMENT INFO ============ -->
            <div style="padding: 0 30px; margin-top: 30px;">
                <div style="background: #f8f9fa; border-radius: 10px; padding: 20px; border: 1px dashed #bdc3c7;">
                    <div style="font-size: 11px; text-transform: uppercase; letter-spacing: 2px; color: #7f8c8d; margin-bottom: 10px; font-weight: 600;">
                        üí≥ Mode de Paiement
                    </div>
                    <div style="font-size: 15px; color: #2c3e50; font-weight: 600;">
                        Esp√®ces √† la livraison (COD - Cash On Delivery)
                    </div>
                </div>
            </div>
            
            <!-- ============ NOTES ============ -->
            <t t-if="o.narration">
                <div style="padding: 0 30px; margin-top: 20px;">
                    <div style="font-size: 11px; text-transform: uppercase; letter-spacing: 2px; color: #7f8c8d; margin-bottom: 8px; font-weight: 600;">
                        üìù Notes
                    </div>
                    <div style="color: #7f8c8d; font-size: 13px; line-height: 1.6;">
                        <span t-field="o.narration"/>
                    </div>
                </div>
            </t>
            
            <!-- ============ FOOTER ============ -->
            <div style="margin-top: 40px; padding: 25px 30px; background: #f8f9fa; border-top: 3px solid #1a5276;">
                <div style="display: flex; justify-content: space-between; align-items: center;">
                    <div>
                        <t t-if="enterprise">
                            <div style="font-weight: 700; color: #1a5276; font-size: 16px;">
                                <t t-esc="enterprise.name"/>
                            </div>
                            <div style="color: #7f8c8d; font-size: 12px; margin-top: 5px;">
                                <t t-if="enterprise.phone"><t t-esc="enterprise.phone"/></t>
                                <t t-if="enterprise.email"> ‚Ä¢ <t t-esc="enterprise.email"/></t>
                                <t t-if="enterprise.website"> ‚Ä¢ <t t-esc="enterprise.website"/></t>
                            </div>
                        </t>
                    </div>
                    <div style="text-align: right; color: #bdc3c7; font-size: 11px;">
                        <div>Document g√©n√©r√© automatiquement</div>
                        <div style="margin-top: 3px;">Powered by Smart Delivery</div>
                    </div>
                </div>
            </div>
            
        </div>
    </template>
    
    <!-- Register the report action -->
    <record id="action_report_delivery_invoice" model="ir.actions.report">
        <field name="name">Facture Livraison (Entreprise)</field>
        <field name="model">account.move</field>
        <field name="report_type">qweb-pdf</field>
        <field name="report_name">smart_delivery.report_delivery_invoice_document</field>
        <field name="report_file">smart_delivery.report_delivery_invoice_document</field>
        <field name="print_report_name">'Facture_Livraison_%s' % (object.name or '').replace('/','_')</field>
        <field name="binding_model_id" ref="account.model_account_move"/>
        <field name="binding_type">report</field>
    </record>
    
</odoo>
